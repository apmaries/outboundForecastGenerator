<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--Removes Google Crawler from indexing page-->
    <meta name="robots" content="noindex" />
  </head>
  <body>
    <script>
      function authorize() {
        // OAuth configuration
        const clientId = "6f99c63b-3dfb-43cf-9792-a9b5c295d0ca";
        const redirectUri =
          "https://apmaries.github.io/outboundFOrecastGenerator/wfm-outbound.html";

        // Get the domain of the parent page from the referrer
        const referrer = document.referrer;
        const prefix = "https://apps.";

        // Ensure that the referrer starts with the expected prefix
        if (referrer.startsWith(prefix)) {
          // Find the index of the first '/' after the prefix
          const firstSlashIndex = referrer.indexOf("/", prefix.length);

          // Extract the substring between the prefix and the first '/'
          const strippedDomain = referrer.substring(
            prefix.length,
            firstSlashIndex
          );

          const authorizationUrl = `https://login.${strippedDomain}/oauth/authorize?client_id=${clientId}&response_type=token&redirect_uri=${redirectUri}`;

          // Log the modified domain and the constructed authorization URL to the console for demonstration
          console.log(`OWH: App environment: ${strippedDomain}`);
          console.log(`OWH: Authorization URL:" ${authorizationUrl}`);

          // Set session storage
          sessionStorage.setItem("environment", strippedDomain);
          sessionStorage.setItem("clientId", clientId);

          // Redirect the user to the authorization URL
          window.location.href = authorizationUrl;
        } else {
          alert(
            `Referrer '${referrer}' does not start with the expected prefix.`
          );
          console.error(
            "OWH: Referrer does not start with the expected prefix."
          );
          console.log(`OWH: Referrer = ${referrer}`);
        }
      }
      // Call the authorize function when the page loads
      authorize();
    </script>
  </body>
</html>
